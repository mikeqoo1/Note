# 黑畫面處理

確保 xRDP backend 沒殘留

```bash
sudo ps aux | grep Xorg
sudo ps aux | grep Xvnc

sudo kill -9 <pid>
```

預防未來重複登入殘留

在 /etc/xrdp/sesman.ini 加上 timeout 設定：

```bash
[Globals]
ReconnectScript=Reconnect.sh
SessionKillTimeLimit=10
```

# 用 Podman 來遠端桌面

安裝建置步驟在 setup_xrdp_podman_desktop.sh 裡

```bash
[Windows RDP Client]
        ↓ 連線 3389
 [Rocky Linux Host xRDP]
        ↓ 登入時自動啟動 Podman container
        ↓ attach 到 container 的 X11 桌面
  ┌────────────────────────┐
  │ Podman container       │
  │  ├─ GNOME / XFCE 桌面   │
  │  ├─ App / Dev Tools    │
  │  └─ 通過 X11 與 Host 桌面通訊 │
  └────────────────────────┘
```

- 權限設定

```bash
echo "%wheel ALL=(ALL) NOPASSWD: /usr/bin/podman" | sudo tee /etc/sudoers.d/podman-nopasswd
sudo usermod -aG wheel mike
```

- 讓 xRDP 預設用 Xorg

需要把 /etc/xrdp/xrdp.ini 裡面的[Xorg]區塊打開

```bash
[Xorg]
name=Xorg
lib=libxorgxrdp.so
username=ask
password=ask
ip=127.0.0.1
port=-1
code=20
```

檢查 /etc/xrdp/sesman.ini 的 Xorg 指令

```bash
[Xorg]
param=/usr/libexec/Xorg
param=-configdir
param=/etc/X11/xrdp
param=-noreset
param=-nolisten
param=tcp
param=-logfile
param=.xorgxrdp.%s.log
```

編輯 /etc/xrdp/sesman.ini

```bash
EnableUserWindowManager=true
UserWindowManager=/etc/xrdp/startwm.sh
DefaultWindowManager=/etc/xrdp/startwm.sh
```

