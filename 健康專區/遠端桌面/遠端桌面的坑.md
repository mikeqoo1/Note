# 無敵遠端桌面攻略本

處理黑畫面的方法

2種不同環境的畫面設定

怎麼融合使用

## 當遠端畫面是黑畫面的處理

確保 xRDP backend 沒殘留

```bash
sudo ps aux | grep Xorg
sudo ps aux | grep Xvnc

sudo kill -9 <pid>
```

預防未來重複登入殘留

在 /etc/xrdp/sesman.ini 加上 timeout 設定：

```bash
[Globals]
ReconnectScript=Reconnect.sh
SessionKillTimeLimit=10
```

## 用 Podman 來遠端桌面 (GNOME版本)

安裝建置步驟在 setup_xrdp_flashback.sh 裡

IMAGE 建置方法:

```bash
podman build -t rocky-gnome-flashback:latest -f Containerfile.gflash
```

## 用 Podman 來遠端桌面 (XFCE版本)

安裝建置步驟在 setup_xrdp_xfce.sh 裡

IMAGE 建置方法:

```bash
podman build -t rocky-xfce:latest -f Containerfile.xfce
```

```bash
[Windows RDP Client]
        ↓ 連線 3389
 [Rocky Linux Host xRDP]
        ↓ 登入時自動啟動 Podman container
        ↓ attach 到 container 的 X11 桌面
  ┌────────────────────────┐
  │ Podman container       │
  │  ├─ GNOME / XFCE 桌面   │
  │  ├─ App / Dev Tools    │
  │  └─ 通過 X11 與 Host 桌面通訊 │
  └────────────────────────┘
```

## 融合使用

需要修改 /etc/xrdp/xrdp.ini

```bash
[Xorg-GNOME]
name=GNOME Flashback (Podman)
lib=libxup.so
username=ask
password=ask
ip=127.0.0.1
port=-1
code=20
DESKTOP_MODE=gnome

[Xorg-XFCE]
name=XFCE (Podman)
lib=libxup.so
username=ask
password=ask
ip=127.0.0.1
port=-1
code=20
DESKTOP_MODE=xfce
```

需要修改 /etc/xrdp/sesman.ini 以下這2段 一個要改路徑 一個要多參數

```bash
[Globals]
UserWindowManager=/etc/xrdp/startwm.sh
DefaultWindowManager=/etc/xrdp/startwm.sh



[SessionVariables]
DESKTOP_MODE=gnome
```

看起來他不吃參數 [SessionVariables] 裡的 DESKTOP_MODE=xfce 就是 xfce 不能共用
