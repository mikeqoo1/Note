# 在樹莓派上使用 USB Webcam 做串流影音

## 架構圖&關鍵字

```
Gstreamer
janus-gateway
gst-omx
```

![架構圖](視訊架構圖.png)

## 安裝Gstream

```
sudo apt-get install libgstreamer1.0-0 gstreamer1.0-plugins-base gstreamer1.0-plugins-good gstreamer1.0-plugins-bad gstreamer1.0-plugins-ugly gstreamer1.0-libav gstreamer1.0-doc gstreamer1.0-tools gstreamer1.0-x gstreamer1.0-alsa gstreamer1.0-gl gstreamer1.0-gtk3 gstreamer1.0-qt5 gstreamer1.0-pulseaudio

sudo apt-get install gstreamer1.0-tools
sudo apt-get install gstreamer1.0-plugins-good
sudo apt-get install gstreamer1.0-omx
```

## 安裝Janus-Gateway

基本上按照這篇, 可以成功使用, 有時間, 我會補上我碰到的問題, 和處理方法

- https://blog.csdn.net/newchenxf/article/details/110451532


## 建立串流平台

```
可用版本:

gst-launch-1.0 -v v4l2src device=/dev/video0 ! videoconvert ! videoscale ! 'video/x-raw, width=800, height=600, framerate=30/1' ! queue ! omxh264enc ! h264parse ! rtph264pay config-interval=1 pt=100 ! udpsink host=127.0.0.1 port=5004

gst-launch-1.0 -v v4l2src device=/dev/video0 ! videoconvert ! videoscale ! 'video/x-raw, width=1920, height=1080, framerate=30/1' ! queue ! omxh264enc ! h264parse ! flvmux ! rtmpsink location='rtmp://192.168.88.181:1935/demo/test live=1'
```


gst-launch-1.0 -v v4l2src device=/dev/video0 ! videoconvert ! videoscale ! 'video/x-raw, width=800, height=600, framerate=30/1' ! queue ! omxh264enc ! h264parse ! rtph264pay config-interval=1 pt=100 ! udpsink host=127.0.0.1 port=5004 ! 
alsasrc device="plughw:1" ! audio/x-raw ! mulawenc ! queue ! rtpmp4apay ! udpsink host=127.0.0.1 port=5002 auto-multicast=true

flvmux name=mux alsasrc device=hw:1 ! audioresample ! audio/x-raw,rate=48000 ! voaacenc bitrate=32000 ! 



gst-launch-1.0 alsasrc device="plughw:1" ! audio/x-raw ! mulawenc ! rtppcmupay ! udpsink host=127.0.0.1 port=5001



gst-launch-1.0 alsasrc device="plughw:1" ! audio/x-raw ! audioconvert ! avenc_aac ! rtpmp4apay ! udpsink host=127.0.0.1 port=5002


audio/x-raw


gst-launch-1.0 alsasrc device="hw:1,0" ! 'audio/x-raw,rate=32000' ! audioconvert ! avenc_aac ! aacparse ! mpegts.  mpegtsmux name=mpegts ! rtpmp2tpay ! udpsink host=127.0.0.1 port=5002


audioconvert ! avenc_aac ! rtpmp4apay


gst-launch-1.0 alsasrc device=hw:1,0 ! mulawenc ! rtppcmupay ! udpsink host=224.1.1.1 auto-multicast=true port=5000

gst-launch-1.0 -v pulsesrc device=alsa_output.pci-0000_00_05.0.analog-stereo.monitor ! queue2 ! audioconvert ! avenc_aac ! rtpmp4apay pt=96 ! queue2 ! rtpbin.send_rtp_sink_1 rtpbin.send_rtp_src_1 ! udpsink host=127.0.0.1 port=5002 async=false


### 執行指令

```
/opt/janus/bin/janus --debug-level=7

pi@raspberrypi:~/janus-gateway/html$ http-server --ssl --cert /home/pi/ssl/cert.pem --key /home/pi/ssl/key.pem

gst-launch-1.0 -v v4l2src device=/dev/video0 ! videoconvert ! videoscale ! 'video/x-raw, width=800, height=600, framerate=30/1' ! queue ! omxh264enc ! h264parse ! rtph264pay config-interval=1 pt=100 ! udpsink host=127.0.0.1 port=5004
```


### 參考網站

- https://blog.csdn.net/newchenxf/article/details/110451532

- https://www.cnblogs.com/xleng/p/10795952.html